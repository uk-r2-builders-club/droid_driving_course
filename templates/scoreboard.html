<!DOCTYPE HTML>
<html>
<head>
	<title>R2 Builders Driving Course</title>
        <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='main.css') }}">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
	<script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
        <script type="text/javascript" charset="utf-8">
	$(document).ready(function() {
                namespace = '/comms';
                var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

	        // Display log messages at the bottom of the screen
                socket.on('my_response', function(msg) {
                       $('.logs').append('<br>' + $('<div/>').text('Log # ' + msg.data).html());
                });

		// Reload the contender area
	        socket.on('reload_contender', function(msg) {
		       $.getJSON("/display/contender",
                               function (json) {
				       console.log(json);
                                       var driver_image;
				       var droid_image;
				       var droid_details;
				       driver_image = "<img src='/static/members/" + json.member_uid + ".jpg' height=200>";
				       droid_image = "<img src='/static/droids/" + json.droid_uid + ".jpg' height=200>";
				       droid_details = "<br />";
				       droid_details += "Weight: " + json.weight + "<br />";
				       droid_details += "Material: " + json.material + "<br />";
				       droid_details += "Controls: " + json.transmitter_type + "<br />";
				       droid_details += "<br />";
                                       $('#driver_image').html(driver_image);
				       $('#driver_name').html(json.member);
				       $('#droid_image').html(droid_image);
				       $('#droid_name').html(json.droid);
                                       $('#droid_details').html(droid_details);
                               });
                });

		// Reload the current run area
                socket.on('reload_current', function(msg) {
                       $.getJSON("/display/current",
                               function (json) {
				       var status_field = document.querySelector('status');
				       var first_half_field = document.querySelector('first_half');
				       var second_half_field = document.querySelector('second_half');
				       var run_status = "No Run";
				       switch (true) {
					       case (json.start == null):
						       run_status = "No run";
						       break;
			                       case ((json.start != null && json.middle_stop == null) || json.middle_start != null && json.end == null):
						       run_status = "Running";
						       break;
					       case (json.middle_stop != null && json.middle_start == null):
						       run_status = "Paused";
						       break;
					       case (json.end != null):
						       run_status = "Finished";
						       break;
				       }
				       if ( json.start !=null && json.middle_stop != null) {
					       start = new Date(json.start).valueOf();
					       middle = new Date(json.middle_stop).valueOf();
					       first_half_field.innerHTML = new Date(middle - start).toISOString().substr(11, 8);
				       }
				       if ( json.middle_start !=null && json.end != null) {
                                               middle = new Date(json.middle_start).valueOf();
                                               end = new Date(json.end).valueOf();
                                               second_half_field.innerHTML = new Date(end - middle).toISOString().substr(11, 8);
                                       }

				       status_field.innerHTML = run_status;


                               });
                });

		// Reload the gates area
                socket.on('reload_gates', function(msg) {
                       $.getJSON("/display/gates",
                               function (json) {
                               });
                });

		// Reload the results table
	        socket.on('reload_results', function(msg) {
		        $.getJSON("/display/results", 
			        function (json) {

				        var tbody;
				        tbody = "";
        			        for (var i = 0; i < json.length; i++) {
				                tbody += "<tr>";
                                                tbody += "<td>" + json[i].member + "</td>";
                                                tbody += "<td>" + json[i].droid + "</td>";
   				                tbody += "<td>" + new Date(json[i].first_half * 1000).toISOString().substr(11, 8) + "</td>";
				                tbody += "<td>" + new Date(json[i].second_half * 1000).toISOString().substr(11, 8) + "</td>";
				                tbody += "<td>" + new Date(json[i].clock_time * 1000).toISOString().substr(11, 8) + "</td>";
						tbody += "<td>" + json[i].num_penalties + "</td>";
                                                tbody += "<td>" + new Date(json[i].final_time * 1000).toISOString().substr(11, 8) + "</td>";
				                tbody += "</tr>";
                                        }
			                $('#results_body').empty().append(tbody);
                                });
                });

        });
        </script>
</head>
<body>
	<div class="grid-container">
		<div class="logo"><img src="/static/r2_builders_logo.jpeg" height=225></div>
		<div class="contender">
                        <table class=contender_table>
                                <tr>
                                        <td id=driver_image>Driver Image</td>
                                        <td id=droid_image>Droid Image</td>
                                        <td rowspan=2 id=droid_details>Droid Details</td>
                                </tr>
				<tr>
					<td id=driver_name>Name</td>
					<td id=droid_name>Droid Name</td>
				</tr>
                        </table>
                </div>
		<div class="current">
			<h2>Current Run</h2>
			<table class="current_run">
				<tr><td>Status</td><td><status></status></td></tr>
				<tr><td>First Half</td><td><first_half></first_half></td></tr>
				<tr><td>Second Half</td><td><second_half></second_half></td></tr>
			</table>
		</div>
		<div class="gates">
			<h2>Gates</h2>
			<table class="gates_table">
			</table>
		</div>
		<div class="results">
			<table class="results_table">
				<thead>
					<tr><th>Driver</th><th>Droid</th><th>First Half</th><th>Second Half</th><th>Clock Time</th><th>Penalties</th><th>Final Time</th></tr>
				</thead>
				<tbody id="results_body">
				</tbody>
			</table>
		</div>
		<div class="logs"></div>
	</div>
</body>
</html>


